
{% extends "chatapp\\base.html" %}

{% block title %}
    About Group - {{ group.name }}
{% endblock title %}

{% block content %}
    <div class="container">
        <h1>About Group: {{ group.name }}</h1>
        {% if group.description %}
            <div class="section">
                <h2>Group Description</h2>
                <p>{{ group.description }}</p>
            </div>
        {% endif %}
        <div class="section">
            <h2>Group Creator</h2>
            <p>
                <a href="/profile/{{ creator.id }}/" id="creator-{{ creator.id }}" class="link">
                    {{ creator.username }}
                </a>
            </p>
        </div>
        <div class="section">
            <h2>Group Creation Time</h2>
            <p>{{ group.created_at|date:"F j, Y, g:i a" }}</p>
        </div>
        <div class="section">
            <h2>Admins</h2>
            <div id="admins">
                {% for admin in admins %}
                    <div class="admin" id="admin-{{ admin.id }}">
                        <a href="/profile/{{ admin.id }}/" class="link">{{ admin.username }}</a>
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="section">
            <h2>Members</h2>
            <div id="members">
                {% for member in members %}
                    <div class="member" id="member-{{ member.id }}">
                        <a href="/profile/{{ member.id }}/" class="link">{{ member.username }}</a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

{% endblock content %}


{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const groupNo = "{{ group.id }}";
            const groupSocket = new WebSocket(
                'ws://' + window.location.host + '/ws/group/' + groupNo + '/about/'
            );

            groupSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);

                if (data.type === 'member_added') {
                    addMember(data.member);
                } else if (data.type === 'member_removed') {
                    removeMember(data.member_id);
                } else if (data.type === 'admin_added') {
                    addAdmin(data.admin);
                } else if (data.type === 'admin_removed') {
                    removeAdmin(data.admin_id);
                }
            };

            function addMember(member) {
                let checkmemberDiv = document.getElementById('member-' + member.id);
                if (checkmemberDiv) {
                    return;
                }
                const membersDiv = document.getElementById('members');
                const memberDiv = document.createElement('div');
                memberDiv.className = 'member';
                memberDiv.id = 'member-' + member.id;
                memberDiv.innerHTML = `<a href="/profile/${member.id}/" class="link">${member.username}</a>`;
                membersDiv.appendChild(memberDiv);
            }

            function removeMember(memberId) {
                const memberDiv = document.getElementById('member-' + memberId);
                if (memberDiv) {
                    memberDiv.remove();
                }
            }

            function addAdmin(admin) {
                const checkAdminDiv = document.getElementById('admin-' + admin.id);
                if (checkAdminDiv) {
                    return;
                }
                const adminsDiv = document.getElementById('admins');
                const adminDiv = document.createElement('div');
                adminDiv.className = 'admin';
                adminDiv.id = 'admin-' + admin.id;
                adminDiv.innerHTML = `<a href="/profile/${admin.id}/" class="link">${admin.username}</a>`;
                adminsDiv.appendChild(adminDiv);
            }

            function removeAdmin(adminId) {
                const adminDiv = document.getElementById('admin-' + adminId);
                if (adminDiv) {
                    adminDiv.remove();
                }
            }
        });
    </script>
{% endblock script %}


{% block style %}
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 20px;
        }
        .section h2 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .section p {
            margin: 0;
        }
        .member, .admin {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .member:last-child, .admin:last-child {
            border-bottom: none;
        }
        .link {
            color: #007bff;
            text-decoration: none;
        }
        .link:hover {
            text-decoration: underline;
        }
    </style>
{% endblock style %}